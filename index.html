<html>
    <head>
        <title></title>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
        <meta name="viewport" lang="*" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">

        <link href="index.css" rel="stylesheet" type="text/css">

        <script src="debounce.js"></script>
        <script src="lru.js"></script>

        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>


        <script src="https://cdn.jsdelivr.net/gh/jcubic/jquery.terminal@11.22.33/js/jquery.terminal.min.js"></script>
        <link href="https://cdn.jsdelivr.net/gh/jcubic/jquery.terminal@11.22.33/css/jquery.terminal.min.css" rel="stylesheet" type="text/css" >

        <link rel="stylesheet prefetch" href="https://cdn.jsdelivr.net/npm/prismjs@1.14.0/themes/prism.css"/>
        <script src="https://cdn.jsdelivr.net/npm/prismjs@1.14.0/prism.min.js"></script>


        <script src="https://cdn.jsdelivr.net/gh/joewalnes/reconnecting-websocket@latest/reconnecting-websocket.min.js"></script>

        <script src="konva.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.9.1/cytoscape.min.js"></script>
        <link href="https://unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" >
        <script src="https://unpkg.com/cytoscape-cxtmenu@latest/cytoscape-cxtmenu.js"></script>
        <script src="https://unpkg.com/cytoscape-undo-redo@latest/cytoscape-undo-redo.js"></script>
        <script src="cytoscape-node-html-label.js"></script>
        <!--<script src="https://cdn.jsdelivr.net/gh/iVis-at-Bilkent/cytoscape.js-node-resize@unstable/cytoscape-node-resize.js"></script>-->
        <script src="cytoscape-node-resize.js"></script>



        <!--<script src="https://unpkg.com/webcola/WebCola/cola.min.js"></script>
        <script src="https://unpkg.com/cytoscape-cola@latest/cytoscape-cola.js"></script>-->


        <link href="https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/6.3.0/jsoneditor.min.css" rel="stylesheet" type="text/css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/6.3.0/jsoneditor.min.js"></script>

        <script src="jsonedit.js"></script>

        <script src="graph.js"></script>
        <script src="terminal.js"></script>
        <script src="attn.js"></script>


        <!-- https://github.com/OSMBuildings/OSMBuildings -->
        <!--<link href="https://cdn.osmbuildings.org/4.0.0/OSMBuildings.css" rel="stylesheet">
        <script src="https://cdn.osmbuildings.org/4.0.0/OSMBuildings.js"></script>
        <script src="map.js"></script>
        -->
    </head>

    <body>
        <div id="graph"></div>
        <!--<div id="map"></div>-->
    </body>
    <script>

        $(document).ready(() => {

            const g = graph(document.getElementById('graph'));

            //const t = terminal($('body'));

            const a = attention(g, (container, x)=>{

                if (x.value)
                    x = x.value; //dereference


                if (typeof x === "string") {
                    container.innerHTML = x.toString();
                } else if (typeof x === "object" && x.ELEMENT_NODE /* HACK find better way of testing DOM element instances */) {

                    container.appendChild(x);

                } else {

                    jsonEdit(x, container);

                }
            });

            a.put('a', $('<button>x</button>')[0]);
                //[1,2,3]);
            a.put('b', {x:"y", z: [0,1]});
            a.put('c', {
                "Array": [1, 2, 3],
                "Boolean": true,
                "Null": null,
                "Number": 123,
                "Object": {"a": "b", "c": "d"},
                "String": "Hello World"
            });


            var ws = new ReconnectingWebSocket('ws://xyz:60606');
            const channel = ws.url;
            var mid = 0;
            //ws.debug = true;
            ws.onmessage = (e)=>{
              //https://developer.mozilla.org/en-US/docs/Web/API/MessageEvent
                const y = JSON.parse(e.data, null);
                a.put(channel + '_' + (mid++), y);
            };
            ws.onopen = ()=>{
                setTimeout(()=> ws.send('x.getClass()'), 2000);
                setTimeout(()=> ws.send('1+1'), 2500);
            };

            const inputBox = $("<div contenteditable='true' style='background-color:black; color:orange; width:100%; height:100%'/>");//<button>?</button><textarea cols='25' rows='3'></textarea>").wrap('div')
            inputBox.keypress((k)=>{
                if (k.keyCode === 13 /* enter */) {
                    const i = inputBox.text();
                    console.log(i);
                    inputBox.text(''); //clear
                    ws.send(i);
                    k.stopPropagation();
                }
            });
            a.put('d', $('<div>').append($('<code>' + ws.url + '</code>'), inputBox)[0]);


            // nodes: [
            //     {data: {id: 'j', name: '1', tpl: (container, data) => {
            //
            //                 jsonEdit({
            //                     "Array": [1, 2, 3],
            //                     "Boolean": true,
            //                     "Null": null,
            //                     "Number": 123,
            //                     "Object": {"a": "b", "c": "d"},
            //                     "String": "Hello World"
            //                 }, container);
            //
            //                 //container.innerHTML = '<iframe src="http://openjdk.java.net"></iframe>';
            //             }, classes: 'html' } },
            //     {data: {id: 'e', name: '2', tpl: (container,data)=>{
            //                 container.innerHTML = '<button>x</button>';
            //             } }, classes: 'html'},
            //     {data: {id: 'ee', tpl: (container,data)=>{
            //                 container.innerHTML =
            //                     "<input type='text' size='10'></input><button>HTML</button><textarea cols='25' rows='3'></textarea>";
            //             } }, classes: 'html'},
            //     {data: {id: 'k', name: '3'}, classes: 'l3'},
            //     {data: {id: 'g', name: '4'}, classes: 'l4'}
            // ],
            //     edges: [
            //     {data: {source: 'j', target: 'e'}},
            //     {data: {source: 'j', target: 'k'}},
            //     {data: {source: 'j', target: 'g'}},
            //     {data: {source: 'e', target: 'j'}},
            //     {data: {source: 'e', target: 'k'}},
            //     {data: {source: 'k', target: 'j'}},
            //     {data: {source: 'k', target: 'e'}},
            //     {data: {source: 'k', target: 'g'}},
            //     {data: {source: 'g', target: 'j'}}
            // ]






        });



    </script>
</html>
